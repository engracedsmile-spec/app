exports.id=4824,exports.ids=[4824],exports.modules={67282:(e,r,t)=>{Promise.resolve().then(t.bind(t,7022))},7022:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>o});var a=t(10326),s=t(49260),n=t(35047);t(17577);var i=t(15971),l=t(87321);/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */function o({children:e}){let{user:r,loading:t}=(0,s.a)();return((0,n.useRouter)(),t||!r||"customer"!==r.userType)?a.jsx(i.Preloader,{}):(0,a.jsxs)("div",{className:"relative flex flex-col h-dvh bg-background text-foreground",children:[a.jsx("main",{className:"flex-1 overflow-y-auto pb-24",children:e}),a.jsx(l.h,{})]})}},26347:(e,r,t)=>{"use strict";t.d(r,{a:()=>C});var a=t(10326),s=t(91664),n=t(29752),i=t(41190),l=t(49260),o=t(77506),d=t(16671),c=t(91216),u=t(12714),m=t(24230),h=t(13961),x=t(45280),p=t(90434),f=t(17577),j=t(59382),y=t(48217),g=t(85999),w=t(76),b=t(14592),N=t(9969),v=t(74064),P=t(27256),I=t(42528),S=t(74723),k=t(55153),z=t(42244),A=t(35047);let W=P.Ry({amount:P.oQ.number().min(100,"Minimum funding amount is ₦100.")}),F=P.Ry({amount:P.oQ.number().min(500,"Minimum withdrawal amount is ₦500."),pin:P.Z_().length(4,"PIN must be 4 digits.")}),T=({setOpen:e})=>{let{user:r,firebaseUser:t}=(0,l.a)(),[n,d]=(0,f.useState)(null),[c,u]=(0,f.useState)(!1),m=(0,b.z)();(0,w.ad)(m);let h=(0,S.cI)({resolver:(0,v.F)(W),defaultValues:{amount:1e3}});(0,f.useEffect)(()=>{(0,y.Rs)().then(d)},[]);let x=async a=>{if(u(!0),!r||!t){g.Am.error("Authentication Error",{description:"You must be logged in to fund your wallet."}),u(!1);return}try{let r=await t.getIdToken(),s=await fetch("/api/wallet/fund",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({amount:h.getValues("amount"),reference:a.reference})}),n=await s.json();if(!s.ok)throw Error(n.message||"Failed to process funding.");g.Am.success("Payment Successful!",{description:"Your wallet has been credited."}),e(!1)}catch(e){g.Am.error("Funding Error",{description:e.message||"There was an issue processing your payment. Please contact support."})}finally{u(!1)}},p=()=>{c||e(!1)},P=(0,j.NL)({reference:new Date().getTime().toString(),email:r?.email||"",amount:100*(h.getValues("amount")||0),publicKey:n?.paystackLivePublicKey});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(z.OX,{children:[a.jsx(z.iI,{children:"Fund Wallet"}),a.jsx(z.u6,{children:"Enter the amount you want to add to your wallet."})]}),a.jsx(z.Ng,{children:a.jsx(N.l0,{...h,children:(0,a.jsxs)("form",{onSubmit:h.handleSubmit(e=>{if(!n?.paystackLivePublicKey){g.Am.error("Payment Gateway Not Configured",{description:"The admin has not configured Paystack. Please contact support."});return}P({onSuccess:x,onClose:p,config:{reference:new Date().getTime().toString(),email:r?.email||"",amount:100*e.amount,publicKey:n?.paystackLivePublicKey}})}),id:"fund-wallet-form",className:"space-y-4 pt-4",children:[a.jsx(N.Wi,{control:h.control,name:"amount",render:({field:e})=>(0,a.jsxs)(N.xJ,{children:[a.jsx(N.lX,{children:"Amount (₦)"}),a.jsx(N.NI,{children:a.jsx(i.I,{type:"number",min:"100",placeholder:"e.g., 5000",...e})}),a.jsx(N.zG,{})]})}),a.jsx(s.z,{type:"submit",className:"w-full h-12 text-lg",disabled:c||!n?.paystackLivePublicKey,children:c?a.jsx(o.Z,{className:"animate-spin"}):"Proceed to Payment"})]})})})]})},Z=({setOpen:e})=>{let{user:r,firestore:t}=(0,l.a)(),[n,d]=(0,f.useState)(!1),c=(0,A.useRouter)(),u=(0,S.cI)({resolver:(0,v.F)(F),defaultValues:{amount:500,pin:""}}),m=async a=>{if(!r)return;if(!r.walletPin){g.Am.error("PIN Not Set",{description:"Please create a wallet PIN before making a withdrawal.",action:{label:"Create PIN",onClick:()=>c.push("/dashboard/wallet/pin")}}),e(!1);return}if(a.amount>(r.walletBalance||0)){g.Am.error("Insufficient Funds",{description:"Withdrawal amount cannot be more than your balance."});return}if(d(!0),!I.compareSync(a.pin,r.walletPin)){g.Am.error("Invalid PIN",{description:"The PIN you entered is incorrect."}),d(!1);return}let s={driverId:r.id,driverName:r.name,amount:a.amount,reason:"User wallet withdrawal",requestedAt:(0,w.Bt)(),status:"pending"},n=(0,w.hJ)(t,"fundRequests");try{await (0,w.ET)(n,s),g.Am.success("Withdrawal Request Sent",{description:"Your request is being processed and will be reviewed by an admin."}),e(!1)}catch(e){g.Am.error("Error",{description:"Could not submit your withdrawal request."})}finally{d(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(z.OX,{children:[a.jsx(z.iI,{children:"Withdraw Funds"}),a.jsx(z.u6,{children:"Enter the amount to withdraw and your PIN to confirm."})]}),a.jsx(z.Ng,{children:a.jsx(N.l0,{...u,children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(m),id:"withdraw-form",className:"space-y-4 pt-4",children:[a.jsx(N.Wi,{control:u.control,name:"amount",render:({field:e})=>(0,a.jsxs)(N.xJ,{children:[a.jsx(N.lX,{children:"Amount (₦)"}),a.jsx(N.NI,{children:a.jsx(i.I,{type:"number",...e})}),a.jsx(N.zG,{})]})}),a.jsx(N.Wi,{control:u.control,name:"pin",render:({field:e})=>(0,a.jsxs)(N.xJ,{children:[a.jsx(N.lX,{children:"Wallet PIN"}),a.jsx(N.NI,{children:a.jsx(i.I,{type:"password",maxLength:4,...e})}),a.jsx(N.zG,{})]})}),a.jsx(s.z,{type:"submit",className:"w-full h-12 text-lg",disabled:n,children:n?a.jsx(o.Z,{className:"animate-spin"}):"Confirm Withdrawal"})]})})})]})},C=()=>{let{user:e}=(0,l.a)(),[r,t]=(0,f.useState)(!0),[i,o]=(0,f.useState)(!1),[j,y]=(0,f.useState)(!1),g=new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(e?.walletBalance||0);return(0,a.jsxs)(n.Zb,{className:"relative overflow-hidden bg-primary/5 border-primary/20 shadow-lg",children:[a.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 text-primary/10",children:a.jsx(d.Z,{className:"w-full h-full",strokeWidth:1})}),(0,a.jsxs)(n.aY,{className:"p-6 space-y-4 relative z-10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Wallet Balance"}),a.jsx("p",{className:"text-3xl font-bold tracking-tight mt-1",children:r?g:"∗∗∗∗∗∗∗"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(s.z,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>t(!r),children:r?a.jsx(c.Z,{className:"h-5 w-5 text-muted-foreground"}):a.jsx(u.Z,{className:"h-5 w-5 text-muted-foreground"})}),a.jsx(p.default,{href:"/dashboard/wallet",children:a.jsx(s.z,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",children:a.jsx(m.Z,{className:"h-5 w-5 text-muted-foreground"})})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[a.jsx(k.h,{open:i,onOpenChange:o,trigger:(0,a.jsxs)(s.z,{variant:"outline",className:"h-12 bg-card/80 backdrop-blur-sm border-primary/20 hover:bg-primary/10",children:[a.jsx(h.Z,{className:"mr-2 h-5 w-5"}),"Fund Wallet"]}),children:a.jsx(T,{setOpen:o})}),a.jsx(k.h,{open:j,onOpenChange:y,trigger:(0,a.jsxs)(s.z,{variant:"outline",className:"h-12 bg-card/80 backdrop-blur-sm border-primary/20 hover:bg-primary/10",children:[a.jsx(x.Z,{className:"mr-2 h-5 w-5"}),"Withdraw"]}),children:a.jsx(Z,{setOpen:y})})]})]})]})}},22834:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var a=t(68570);let s=(0,a.createProxy)(String.raw`/root/app/src/app/dashboard/layout.tsx`),{__esModule:n,$$typeof:i}=s;s.default;let l=(0,a.createProxy)(String.raw`/root/app/src/app/dashboard/layout.tsx#default`)}};