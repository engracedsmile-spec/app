"use strict";(()=>{var e={};e.id=6517,e.ids=[6517],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},12594:e=>{e.exports=require("firebase-admin/firestore")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},15045:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{POST:()=>p});var t=r(49303),n=r(88716),s=r(60670),o=r(87070),d=r(6128),c=r(95323),l=r(12594);async function p(e){try{let{adminDb:a}=(0,d.IW)(),r=await e.json(),i={...r,status:"pending",appliedAt:l.FieldValue.serverTimestamp()},t=a.collection("driverApplications"),n=await t.add(i);return await (0,c.x)({title:"New Driver Application",description:`${r.name} has applied to be a driver.`,type:"driver",href:"/admin/dashboard/drivers"}),o.NextResponse.json({success:!0,applicationId:n.id},{status:201})}catch(e){return console.error("API Error creating driver application:",e),o.NextResponse.json({message:e.message||"An internal server error occurred."},{status:500})}}let m=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/signup/driver/route",pathname:"/api/signup/driver",filename:"route",bundlePath:"app/api/signup/driver/route"},resolvedPagePath:"/root/app/src/app/api/signup/driver/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:g,serverHooks:v}=m,w="/api/signup/driver/route";function h(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},6128:(e,a,r)=>{r.d(a,{FH:()=>l,IW:()=>d,y3:()=>c});var i=r(92509),t=r.n(i),n=r(60325),s=r(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let a={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,n.getApps)().length?(0,n.getApps)()[0]:t().initializeApp({credential:t().credential.cert(a),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:t().firestore(e),adminAuth:t().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let c=e=>{let{adminAuth:a}=d();return a.verifyIdToken(e)},l=async(e,a)=>{let{adminDb:r}=d(),i=await c(e),t=(await r.doc(`users/${i.uid}`).get()).data();if(!t)throw Error(`Permission Denied: User with UID ${i.uid} not found in Firestore.`);let n=t.role;if(!n||!s._[n])throw Error(`Permission Denied: User role '${n}' is not defined or has no permissions.`);if(!s._[n]?.includes(a))throw Error(`Permission Denied: User with role '${n}' does not have the required '${a}' permission.`);return!0}},95323:(e,a,r)=>{r.d(a,{i:()=>n,x:()=>t});var i=r(6128);/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 *
 * So, you're looking at my code, huh? That's cool. Just don't copy it without asking.
 * I poured my heart, soul, and a questionable amount of caffeine into this.
 * Find me on socials @mdtbmw if you want to geek out over code.
 */let t=async e=>{let{adminDb:a}=(0,i.IW)(),r=a.collection("users").where("role","==","Manager"),t=await r.get();if(t.empty){console.warn("Trying to notify admins, but I can't find any. Are they all on vacation?");return}let n=a.batch();t.forEach(r=>{let i=r.data(),t=a.collection(`users/${i.id}/notifications`).doc(),s={...e,userId:i.id,read:!1,createdAt:new Date};n.set(t,s)});try{await n.commit()}catch(e){console.error("Failed to send admin notifications. Someone's probably getting a phone call.",e)}},n=async(e,a)=>{let{adminDb:r}=(0,i.IW)();try{let i=r.collection(`users/${e}/notifications`).doc(),t={...a,userId:e,read:!1,createdAt:new Date};await i.set(t)}catch(a){console.error("Failed to send notification to user:",e,a)}}},89155:(e,a,r)=>{r.d(a,{_:()=>i});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let i={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),i=a.X(0,[8948,5059],()=>r(15045));module.exports=i})();