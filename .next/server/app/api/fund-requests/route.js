"use strict";(()=>{var e={};e.id=5285,e.ids=[5285],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},12594:e=>{e.exports=require("firebase-admin/firestore")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},94518:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var a={};t.r(a),t.d(a,{POST:()=>l});var n=t(49303),i=t(88716),s=t(60670),o=t(87070),d=t(6128),u=t(95323),c=t(12594);async function l(e){try{let{adminDb:r}=(0,d.IW)(),t=e.headers.get("Authorization");if(!t)return o.NextResponse.json({message:"Authorization required."},{status:401});let a=t.split("Bearer ")[1],n=await (0,d.y3)(a),i=n.uid,s=n.name||"A Driver",{amount:l,reason:m}=await e.json();if(!l||!m)return o.NextResponse.json({message:"Missing required fields for fund request."},{status:400});let p={amount:l,reason:m,driverId:i,driverName:s,requestedAt:c.FieldValue.serverTimestamp(),status:"pending"};return await r.collection("fundRequests").add(p),await (0,u.x)({title:"New Fund Request",description:`${s} has requested â‚¦${l} for "${m}".`,type:"wallet",href:"/admin/dashboard/payouts"}),o.NextResponse.json({success:!0,message:"Fund request submitted successfully."},{status:201})}catch(e){return console.error("API Error creating fund request:",e),o.NextResponse.json({message:e.message||"An internal server error occurred."},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/fund-requests/route",pathname:"/api/fund-requests",filename:"route",bundlePath:"app/api/fund-requests/route"},resolvedPagePath:"/root/app/src/app/api/fund-requests/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:f}=m,v="/api/fund-requests/route";function h(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},6128:(e,r,t)=>{t.d(r,{FH:()=>c,IW:()=>d,y3:()=>u});var a=t(92509),n=t.n(a),i=t(60325),s=t(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let r={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,i.getApps)().length?(0,i.getApps)()[0]:n().initializeApp({credential:n().credential.cert(r),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:n().firestore(e),adminAuth:n().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let u=e=>{let{adminAuth:r}=d();return r.verifyIdToken(e)},c=async(e,r)=>{let{adminDb:t}=d(),a=await u(e),n=(await t.doc(`users/${a.uid}`).get()).data();if(!n)throw Error(`Permission Denied: User with UID ${a.uid} not found in Firestore.`);let i=n.role;if(!i||!s._[i])throw Error(`Permission Denied: User role '${i}' is not defined or has no permissions.`);if(!s._[i]?.includes(r))throw Error(`Permission Denied: User with role '${i}' does not have the required '${r}' permission.`);return!0}},95323:(e,r,t)=>{t.d(r,{i:()=>i,x:()=>n});var a=t(6128);/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 *
 * So, you're looking at my code, huh? That's cool. Just don't copy it without asking.
 * I poured my heart, soul, and a questionable amount of caffeine into this.
 * Find me on socials @mdtbmw if you want to geek out over code.
 */let n=async e=>{let{adminDb:r}=(0,a.IW)(),t=r.collection("users").where("role","==","Manager"),n=await t.get();if(n.empty){console.warn("Trying to notify admins, but I can't find any. Are they all on vacation?");return}let i=r.batch();n.forEach(t=>{let a=t.data(),n=r.collection(`users/${a.id}/notifications`).doc(),s={...e,userId:a.id,read:!1,createdAt:new Date};i.set(n,s)});try{await i.commit()}catch(e){console.error("Failed to send admin notifications. Someone's probably getting a phone call.",e)}},i=async(e,r)=>{let{adminDb:t}=(0,a.IW)();try{let a=t.collection(`users/${e}/notifications`).doc(),n={...r,userId:e,read:!1,createdAt:new Date};await a.set(n)}catch(r){console.error("Failed to send notification to user:",e,r)}}},89155:(e,r,t)=>{t.d(r,{_:()=>a});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let a={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5059],()=>t(94518));module.exports=a})();