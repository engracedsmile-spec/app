"use strict";(()=>{var e={};e.id=2789,e.ids=[2789],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},88788:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var t={};r.r(t),r.d(t,{POST:()=>p});var n=r(49303),i=r(88716),s=r(60670),o=r(24330);r(60166);var d=r(6128),m=r(87070);async function p(e){let{adminDb:a}=(0,d.IW)(),{reference:r,bookingId:t}=await e.json();if(!t)return m.NextResponse.json({message:"Booking ID is required."},{status:400});try{let e=a.collection("bookings").doc(t);await a.runTransaction(async a=>{let r=await a.get(e);if(!r.exists)throw Error(`Booking with ID ${t} not found.`);let n=r.data();if("Pending"!==n.status){console.log(`Charter booking ${t} already processed with status: ${n.status}`);return}a.update(e,{status:"Confirmed"})});let r=(await e.get()).data(),n={code:r.id,passengerName:r.passengerName,passengers:r.passengers,pickupAddress:r.pickupAddress,destinationAddress:r.destinationAddress,itemDescription:r.itemDescription,travelDate:r.travelDate,title:r.title,bookingType:r.bookingType};return m.NextResponse.json({success:!0,bookingDetails:n})}catch(e){return console.error("Error finalizing charter booking:",e),m.NextResponse.json({message:e.message||"An internal server error occurred during charter booking finalization."},{status:500})}}(0,r(40618).h)([p]),(0,o.j)("330db36c962291ef680df2487476e9ae31eb5e6b",p);let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/verify-charter-payment/route",pathname:"/api/verify-charter-payment",filename:"route",bundlePath:"app/api/verify-charter-payment/route"},resolvedPagePath:"/root/app/src/app/api/verify-charter-payment/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:g}=c,v="/api/verify-charter-payment/route";function h(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}},6128:(e,a,r)=>{r.d(a,{FH:()=>p,IW:()=>d,y3:()=>m});var t=r(92509),n=r.n(t),i=r(60325),s=r(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let a={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,i.getApps)().length?(0,i.getApps)()[0]:n().initializeApp({credential:n().credential.cert(a),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:n().firestore(e),adminAuth:n().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let m=e=>{let{adminAuth:a}=d();return a.verifyIdToken(e)},p=async(e,a)=>{let{adminDb:r}=d(),t=await m(e),n=(await r.doc(`users/${t.uid}`).get()).data();if(!n)throw Error(`Permission Denied: User with UID ${t.uid} not found in Firestore.`);let i=n.role;if(!i||!s._[i])throw Error(`Permission Denied: User role '${i}' is not defined or has no permissions.`);if(!s._[i]?.includes(a))throw Error(`Permission Denied: User with role '${i}' does not have the required '${a}' permission.`);return!0}},89155:(e,a,r)=>{r.d(a,{_:()=>t});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let t={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var a=require("../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[8948,5059,8341],()=>r(88788));module.exports=t})();