"use strict";(()=>{var e={};e.id=1317,e.ids=[1317],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},12594:e=>{e.exports=require("firebase-admin/firestore")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45174:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>f,patchFetch:()=>A,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var i={};s.r(i),s.d(i,{DELETE:()=>c,GET:()=>u,PUT:()=>m});var a=s(49303),n=s(88716),t=s(60670),o=s(87070),d=s(6128),l=s(12594);async function u(e,{params:r}){try{let{adminDb:s}=(0,d.IW)(),i=e.headers.get("Authorization");if(!i)return o.NextResponse.json({message:"No authorization token provided"},{status:401});let a=i.split("Bearer ")[1];await (0,d.FH)(a,"manageUsers");let n=r.id;if(!n)return o.NextResponse.json({message:"User ID is required"},{status:400});let t=await s.collection("users").doc(n).get();if(!t.exists)return o.NextResponse.json({message:"User not found"},{status:404});return o.NextResponse.json({id:t.id,...t.data()})}catch(s){if(console.error(`API Error in /api/admin/users/${r.id} (GET):`,s),s.message.includes("Firebase Admin SDK is not initialized"))return o.NextResponse.json({message:"Server Error: Firebase Admin SDK not initialized."},{status:500});let e=s.message.includes("Permission Denied")?403:500;return o.NextResponse.json({message:s.message||"Internal Server Error"},{status:e})}}async function m(e,{params:r}){try{let{adminDb:s}=(0,d.IW)(),i=e.headers.get("Authorization");if(!i)return o.NextResponse.json({message:"No authorization token provided"},{status:401});let a=i.split("Bearer ")[1];await (0,d.FH)(a,"manageUsers");let n=r.id,t=await e.json(),u=["Manager","Support","Finance","Marketing"].includes(t.role),m="driver"===t.role,c={name:t.name,email:t.email,phone:t.phone,status:t.status,userType:u?"admin":t.role,role:u?t.role:l.FieldValue.delete(),vehicle:m?t.vehicle:l.FieldValue.delete(),licensePlate:m?t.licensePlate:l.FieldValue.delete(),terminalId:m?t.terminalId:l.FieldValue.delete()},p=s.collection("users").doc(n);await p.update(c);let g=await p.get();return o.NextResponse.json({id:g.id,...g.data()})}catch(s){if(console.error(`API Error in /api/admin/users/${r.id} (PUT):`,s),s.message.includes("Firebase Admin SDK is not initialized"))return o.NextResponse.json({message:"Server Error: Firebase Admin SDK not initialized."},{status:500});let e=s.message.includes("Permission Denied")?403:500;return o.NextResponse.json({message:s.message||"Internal Server Error"},{status:e})}}async function c(e,{params:r}){try{let{adminAuth:s,adminDb:i}=(0,d.IW)(),a=e.headers.get("Authorization");if(!a)return o.NextResponse.json({message:"No authorization token provided"},{status:401});let n=a.split("Bearer ")[1];await (0,d.FH)(n,"manageUsers");let t=r.id;await i.collection("users").doc(t).delete();try{await s.deleteUser(t)}catch(e){"auth/user-not-found"!==e.code&&console.warn(`Could not delete Firebase Auth user ${t}:`,e.message)}return o.NextResponse.json({success:!0,message:"User deleted successfully."})}catch(s){if(console.error(`API Error in /api/admin/users/${r.id} (DELETE):`,s),s.message.includes("Firebase Admin SDK is not initialized"))return o.NextResponse.json({message:"Server Error: Firebase Admin SDK not initialized."},{status:500});let e=s.message.includes("Permission Denied")?403:500;return o.NextResponse.json({message:s.message||"Internal Server Error"},{status:e})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/users/[id]/route",pathname:"/api/admin/users/[id]",filename:"route",bundlePath:"app/api/admin/users/[id]/route"},resolvedPagePath:"/root/app/src/app/api/admin/users/[id]/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:h}=p,f="/api/admin/users/[id]/route";function A(){return(0,t.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},6128:(e,r,s)=>{s.d(r,{FH:()=>u,IW:()=>d,y3:()=>l});var i=s(92509),a=s.n(i),n=s(60325),t=s(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let r={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,n.getApps)().length?(0,n.getApps)()[0]:a().initializeApp({credential:a().credential.cert(r),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:a().firestore(e),adminAuth:a().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let l=e=>{let{adminAuth:r}=d();return r.verifyIdToken(e)},u=async(e,r)=>{let{adminDb:s}=d(),i=await l(e),a=(await s.doc(`users/${i.uid}`).get()).data();if(!a)throw Error(`Permission Denied: User with UID ${i.uid} not found in Firestore.`);let n=a.role;if(!n||!t._[n])throw Error(`Permission Denied: User role '${n}' is not defined or has no permissions.`);if(!t._[n]?.includes(r))throw Error(`Permission Denied: User with role '${n}' does not have the required '${r}' permission.`);return!0}},89155:(e,r,s)=>{s.d(r,{_:()=>i});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let i={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),i=r.X(0,[8948,5059],()=>s(45174));module.exports=i})();