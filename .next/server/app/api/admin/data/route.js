"use strict";(()=>{var e={};e.id=9899,e.ids=[9899],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},80551:(e,a,i)=>{i.r(a),i.d(a,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>u});var n={};i.r(n),i.d(n,{GET:()=>c});var t=i(49303),r=i(88716),s=i(60670),o=i(87070),d=i(6128),m=i(89155);async function c(e){try{let{adminDb:a}=(0,d.IW)(),i=e.headers.get("Authorization");if(!i)return o.NextResponse.json({message:"No authorization token provided"},{status:401});let n=i.split("Bearer ")[1];await (0,d.FH)(n,"viewDashboard");let t=await (0,d.y3)(n),r=(await a.doc(`users/${t.uid}`).get()).data();if(!r)throw Error(`User with UID ${t.uid} not found in Firestore.`);let s=r.role,c=m._[s]||[],l=async(e,a)=>c.includes(e)?a.get():{docs:[]},p=async(e,a)=>c.includes(e)?a.get():null,[u,g,v,h,w,A,y,f,E,P]=await Promise.all([l("manageShipments",a.collection("bookings").orderBy("createdAt","desc")),l("manageUsers",a.collection("users")),l("managePayouts",a.collection("fundRequests").where("status","==","pending")),l("manageShipments",a.collection("scheduledTrips").orderBy("departureDate","desc")),l("managePayouts",a.collection("expenses").orderBy("date","desc")),l("manageDrivers",a.collection("driverApplications")),p("manageSettings",a.doc("settings/pricing")),l("manageSettings",a.collection("vehicles")),l("managePayouts",a.collection("payments").orderBy("date","desc")),l("managePayouts",a.collection("transfers").orderBy("date","desc"))]),S=u.docs.map(e=>({id:e.id,...e.data()})),b=g.docs.map(e=>({id:e.id,...e.data()})),D=v.docs.map(e=>({id:e.id,...e.data()})),F=h.docs.map(e=>({id:e.id,...e.data()})),I=w.docs.map(e=>({id:e.id,...e.data()})),R=A.docs.map(e=>({id:e.id,...e.data()})),x=f.docs.map(e=>({id:e.id,...e.data()})),M=E.docs.map(e=>({id:e.id,...e.data()})),T=P.docs.map(e=>({id:e.id,...e.data()})),U=y?.data()||null;return o.NextResponse.json({bookings:S,users:b,fundRequests:D,scheduledTrips:F,expenses:I,pricingSettings:U,driverApplications:R,vehicles:x,payments:M,transfers:T})}catch(a){if(console.error("API Error in /api/admin/data:",a),a.message.includes("Firebase Admin SDK is not initialized"))return o.NextResponse.json({message:"Server Error: Firebase Admin SDK not initialized."},{status:500});let e=a.message.includes("Permission Denied")?403:500;return o.NextResponse.json({message:a.message||"Internal Server Error"},{status:e})}}let l=new t.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/data/route",pathname:"/api/admin/data",filename:"route",bundlePath:"app/api/admin/data/route"},resolvedPagePath:"/root/app/src/app/api/admin/data/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:g}=l,v="/api/admin/data/route";function h(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:u})}},6128:(e,a,i)=>{i.d(a,{FH:()=>c,IW:()=>d,y3:()=>m});var n=i(92509),t=i.n(n),r=i(60325),s=i(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let a={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,r.getApps)().length?(0,r.getApps)()[0]:t().initializeApp({credential:t().credential.cert(a),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:t().firestore(e),adminAuth:t().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let m=e=>{let{adminAuth:a}=d();return a.verifyIdToken(e)},c=async(e,a)=>{let{adminDb:i}=d(),n=await m(e),t=(await i.doc(`users/${n.uid}`).get()).data();if(!t)throw Error(`Permission Denied: User with UID ${n.uid} not found in Firestore.`);let r=t.role;if(!r||!s._[r])throw Error(`Permission Denied: User role '${r}' is not defined or has no permissions.`);if(!s._[r]?.includes(a))throw Error(`Permission Denied: User with role '${r}' does not have the required '${a}' permission.`);return!0}},89155:(e,a,i)=>{i.d(a,{_:()=>n});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let n={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var a=require("../../../../webpack-runtime.js");a.C(e);var i=e=>a(a.s=e),n=a.X(0,[8948,5059],()=>i(80551));module.exports=n})();