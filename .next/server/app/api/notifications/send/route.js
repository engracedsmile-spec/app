"use strict";(()=>{var e={};e.id=1588,e.ids=[1588],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21824:(e,a,n)=>{n.r(a),n.d(a,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>u});var t={};n.r(t),n.d(t,{POST:()=>d});var i=n(49303),r=n(88716),o=n(60670),s=n(87070),c=n(95323);async function d(e){try{let{userId:a,payload:n,isAdmin:t=!1}=await e.json();if(!n)return s.NextResponse.json({error:"Notification payload is required"},{status:400});if(t)await (0,c.x)(n);else{if(!a)return s.NextResponse.json({error:"User ID is required for user notifications"},{status:400});await (0,c.i)(a,n)}return s.NextResponse.json({success:!0})}catch(e){return console.error("Error sending notification:",e),s.NextResponse.json({error:"Failed to send notification"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/notifications/send/route",pathname:"/api/notifications/send",filename:"route",bundlePath:"app/api/notifications/send/route"},resolvedPagePath:"/root/app/src/app/api/notifications/send/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:u,serverHooks:p}=l,g="/api/notifications/send/route";function f(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:u})}},6128:(e,a,n)=>{n.d(a,{FH:()=>l,IW:()=>c,y3:()=>d});var t=n(92509),i=n.n(t),r=n(60325),o=n(89155);let s=null;function c(){if(!s)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return s}!function(){if(s)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let a={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,r.getApps)().length?(0,r.getApps)()[0]:i().initializeApp({credential:i().credential.cert(a),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});s={adminApp:e,adminDb:i().firestore(e),adminAuth:i().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let d=e=>{let{adminAuth:a}=c();return a.verifyIdToken(e)},l=async(e,a)=>{let{adminDb:n}=c(),t=await d(e),i=(await n.doc(`users/${t.uid}`).get()).data();if(!i)throw Error(`Permission Denied: User with UID ${t.uid} not found in Firestore.`);let r=i.role;if(!r||!o._[r])throw Error(`Permission Denied: User role '${r}' is not defined or has no permissions.`);if(!o._[r]?.includes(a))throw Error(`Permission Denied: User with role '${r}' does not have the required '${a}' permission.`);return!0}},95323:(e,a,n)=>{n.d(a,{i:()=>r,x:()=>i});var t=n(6128);/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 *
 * So, you're looking at my code, huh? That's cool. Just don't copy it without asking.
 * I poured my heart, soul, and a questionable amount of caffeine into this.
 * Find me on socials @mdtbmw if you want to geek out over code.
 */let i=async e=>{let{adminDb:a}=(0,t.IW)(),n=a.collection("users").where("role","==","Manager"),i=await n.get();if(i.empty){console.warn("Trying to notify admins, but I can't find any. Are they all on vacation?");return}let r=a.batch();i.forEach(n=>{let t=n.data(),i=a.collection(`users/${t.id}/notifications`).doc(),o={...e,userId:t.id,read:!1,createdAt:new Date};r.set(i,o)});try{await r.commit()}catch(e){console.error("Failed to send admin notifications. Someone's probably getting a phone call.",e)}},r=async(e,a)=>{let{adminDb:n}=(0,t.IW)();try{let t=n.collection(`users/${e}/notifications`).doc(),i={...a,userId:e,read:!1,createdAt:new Date};await t.set(i)}catch(a){console.error("Failed to send notification to user:",e,a)}}},89155:(e,a,n)=>{n.d(a,{_:()=>t});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let t={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var a=require("../../../../webpack-runtime.js");a.C(e);var n=e=>a(a.s=e),t=a.X(0,[8948,5059],()=>n(21824));module.exports=t})();