"use strict";(()=>{var e={};e.id=3744,e.ids=[3744],e.modules={92509:e=>{e.exports=require("firebase-admin")},60325:e=>{e.exports=require("firebase-admin/app")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72778:(e,r,i)=>{i.r(r),i.d(r,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>c,staticGenerationAsyncStorage:()=>p});var a={};i.r(a),i.d(a,{GET:()=>m});var n=i(49303),t=i(88716),s=i(60670),o=i(87070),d=i(6128);/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */async function m(e){try{let{adminDb:r}=(0,d.IW)(),i=e.headers.get("Authorization");if(!i)return o.NextResponse.json({message:"No authorization token provided"},{status:401});let a=i.split("Bearer ")[1],n=await (0,d.y3)(a),t=await r.doc(`users/${n.uid}`).get();if(!t.exists)return o.NextResponse.json({message:"User profile not found."},{status:404});let s={id:t.id,...t.data()};return o.NextResponse.json(s)}catch(i){console.error("API Error fetching user profile:",i.message);let e=500,r=i.message||"An internal server error occurred.";return i.message.includes("Firebase Admin SDK is not initialized")?(r="Server Error: Firebase Admin SDK not initialized.",e=500):"auth/id-token-expired"===i.code||"auth/argument-error"===i.code?(r="Your session is invalid. Please sign in again.",e=401):i.message.includes("Permission Denied")&&(e=403),o.NextResponse.json({message:r},{status:e})}}let u=new n.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"/root/app/src/app/api/user/profile/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:c}=u,g="/api/user/profile/route";function v(){return(0,s.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:p})}},6128:(e,r,i)=>{i.d(r,{FH:()=>u,IW:()=>d,y3:()=>m});var a=i(92509),n=i.n(a),t=i(60325),s=i(89155);let o=null;function d(){if(!o)throw Error("Firebase Admin SDK is not initialized. Check server logs and environment variables.");return o}!function(){if(o)return;let e=process.env.FIREBASE_PRIVATE_KEY;if(!e||!process.env.FIREBASE_CLIENT_EMAIL){console.error("CRITICAL ERROR: Firebase Admin credentials are not fully set in environment variables. Admin features will fail.");return}let r={projectId:"studio-8506488239-824d2",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e.replace(/\\n/g,"\n")};try{let e=(0,t.getApps)().length?(0,t.getApps)()[0]:n().initializeApp({credential:n().credential.cert(r),databaseURL:"https://studio-8506488239-824d2.firebaseio.com"});o={adminApp:e,adminDb:n().firestore(e),adminAuth:n().auth(e)},console.log("Firebase Admin SDK initialized successfully.")}catch(e){console.error("Firebase Admin SDK initialization error:",e.message)}}();let m=e=>{let{adminAuth:r}=d();return r.verifyIdToken(e)},u=async(e,r)=>{let{adminDb:i}=d(),a=await m(e),n=(await i.doc(`users/${a.uid}`).get()).data();if(!n)throw Error(`Permission Denied: User with UID ${a.uid} not found in Firestore.`);let t=n.role;if(!t||!s._[t])throw Error(`Permission Denied: User role '${t}' is not defined or has no permissions.`);if(!s._[t]?.includes(r))throw Error(`Permission Denied: User with role '${t}' does not have the required '${r}' permission.`);return!0}},89155:(e,r,i)=>{i.d(r,{_:()=>a});/**
 * @project Engraced Smiles
 * @author Daniel Innocent <@mdtbmw>
 * @copyright Copyright (c) 2024. All rights reserved.
 * This software is the exclusive property of Daniel Innocent.
 * A license has been granted to Mr. Ismail Muhammed for resale to Engraced Smiles.
 */let a={Manager:["viewDashboard","viewOperations","viewFinancials","viewAnalytics","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageTeam","managePayouts","managePayments","sendNotifications","viewReports","manageTemplates","managePrograms","managePromotions","manageSupport","manageEmergencies","manageSettings","manageFrontend","manageSystem","viewMarketing","manageInventory"],Support:["viewDashboard","viewOperations","manageShipments","manageUsers","manageDrivers","viewMore","manageAccount","manageSupport","manageEmergencies"],Finance:["viewDashboard","viewFinancials","viewAnalytics","viewMore","manageAccount","managePayouts","managePayments","viewReports","manageSettings"],Marketing:["viewDashboard","viewMarketing","viewAnalytics","viewMore","manageAccount","sendNotifications","manageTemplates","managePrograms","managePromotions","manageFrontend"]}}};var r=require("../../../../webpack-runtime.js");r.C(e);var i=e=>r(r.s=e),a=r.X(0,[8948,5059],()=>i(72778));module.exports=a})();